---
import Layout from '../layouts/Layout.astro';
import BlogPost from '../components/BlogPost.astro';

// Dynamically import markdown posts
const allPosts = Object.entries(import.meta.glob('./posts/*.md', { eager: true }))
  .map(([path, post]) => ({
    url: path.replace('./', '/').replace('.md', ''),
    ...post.frontmatter
  }))
  .sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

// Get unique tags
const uniqueTags = [...new Set(allPosts.flatMap(post => post.tags))];
---

<Layout title="Blog">
  <section class="space-y-10">
    <h1 class="text-3xl font-bold">Blog</h1>
    <p class="text-lg text-[var(--color-text)]">
      This is where I share things that I'm working on, find interesting, 
      want to learn more about, or whatever else I feel like writing.
      <br /><br />
      If for whatever reason you want to see more, you can follow the
      <a href="/rss.xml" class="text-accent hover:underline">RSS feed</a>.
    </p>

    <h2 class="text-2xl font-semibold text-[var(--color-heading)] mb-6">Latest Posts</h2>
    <ul class="space-y-8">
      {allPosts.map((post) => (
        <li class="transform transition-transform duration-300 ease-in-out hover:scale-105">
          <article class="bg-[var(--color-bg)] rounded-lg p-6 shadow-lg hover:shadow-2xl transition-shadow duration-300">
            <h3 class="text-2xl font-bold text-[var(--color-text)] mb-4 hover:text-[var(--color-accent)]">
              <a href={post.url}>{post.title}</a>
            </h3>
            <p class="text-[var(--color-text)] mb-4">{post.description}</p>
            <time class="text-sm text-[var(--color-accent)]">{new Date(post.pubDate).toLocaleDateString()}</time>
          </article>
        </li>
      ))}
    </ul>

    <h2 class="text-2xl font-semibold text-[var(--color-heading)] mb-6">Tags</h2>
    <ul class="flex flex-wrap gap-4">
      {uniqueTags.map((tag) => (
        <li>
          <a 
            href={`/tags/${tag}`} 
            class="px-5 py-2 rounded-full bg-[var(--color-border)] text-[var(--color-text)] font-semibold transition-transform duration-300 hover:scale-110 hover:bg-[var(--color-accent)]"
          >
            #{tag}
          </a>
        </li>
      ))}
    </ul>
  </section>
</Layout>
---
import Layout from "../layouts/Layout.astro";
import BlogCard from "../components/BlogCard.astro";
import "../styles/global.css";
import { getReadingTime, formatReadingTime } from "../utils/reading-time";

const allPosts = Object.entries(
  (import.meta as any).glob("./posts/*.md", { eager: true })
)
  .map(([path, post]) => {
    const content = (post as any).compiledContent?.() || '';
    return {
      url: path.replace("./", "/").replace(".md", ""),
      ...(post as any).frontmatter,
      readingTime: getReadingTime(content),
    };
  })
  .sort(
    (a, b) => new Date(b.pubDate).getTime() - new Date(a.pubDate).getTime()
  );

const uniqueTags = [...new Set(allPosts.flatMap((post) => post.tags))];

function formatDate(dateString: string | number | Date) {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<Layout title="baju | blog">
  <section class="space-y-10">
    <div class="mb-8">
      <h1 class="mb-4">Blog</h1>
      <p class="text-[var(--color-text)] mb-3">
        This is where I share things that I'm working on, find interesting, want
        to learn more about, or whatever else I feel like writing.
      </p>
      <div class="flex items-center gap-4">
        <span class="text-[var(--color-text)]">{allPosts.length} post{allPosts.length !== 1 ? 's' : ''}</span>
        <span class="text-[var(--color-text)]">â€¢</span>
        <a href="/rss.xml" class="rss-link">RSS</a>
      </div>
    </div>

    <div class="space-y-6">
      {allPosts.map((post) => (
        <BlogCard
          url={post.url}
          title={post.title}
          description={post.description}
          pubDate={formatDate(post.pubDate)}
          tags={post.tags}
          readingTime={formatReadingTime(post.readingTime)}
        />
      ))}
    </div>
  </section>
</Layout>